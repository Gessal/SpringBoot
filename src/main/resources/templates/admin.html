<!doctype html>
<html lang="en" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4"
	  			xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="webjars/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet"><title>BootStrap</title>
	<style type="text/css">
		.flex {
			height: 100vh;
		}
	</style>
  </head>
  <body>
	<!-- Шапка -->
    <div class="container-fluid bg-dark text-white">
      <div class="row px-3 py-2">
        <div class=col-6>
			<h4 class="text-left"><span class="font-weight-bolder" th:text="${#authentication.name}"></span> with roles:
				<span class="font-weight-normal" th:each="role : ${#authentication.authorities}">
					<r th:text="${role.getAuthority().replace('ROLE_', '')}"></r>
				</span>
			</h4>
        </div>
        <div class=col-6>
			<h4 class="text-right"><a href="/logout" class="text-secondary text-decoration-none">Logout</a></h4>
        </div>
      </div>
    </div>
	
	<!-- Переключатель админ/пользователь -->
	<div class="container-fluid p-0">
	<div class="row no-gutters flex">
		<div class="col-2">
			<div class="nav nav-pills flex-column" role="tablist" aria-orientation="vertical">
				<a sec:authorize="hasRole('ROLE_ADMIN')" class="nav-link active" id="admin-tab" data-toggle="pill" href="#pill-admin" role="tab" aria-controls="pill-admin" aria-selected="true">Admin</a>
				<a class="nav-link" th:classappend="${#authorization.expression('hasRole(''ROLE_ADMIN'')')} ? '' : active" id="user-tab" data-toggle="pill" href="#pill-user" role="tab" aria-controls="pill-user" th:attr="aria-selected=${#authorization.expression('hasRole(''ROLE_ADMIN'')')} ? false : true">User</a>
			</div>
		</div>
		<div class="col-10 bg-light">
			<div class="tab-content">
				<!--Вкладка админа-->
				<div sec:authorize="hasRole('ROLE_ADMIN')" class="tab-pane fade show active" id="pill-admin" role="tabpanel" aria-labelledby="admin-tab">
					<h1 class="p-3">Admin panel</h1>
					<div class="container-fluid">
						<ul class="nav nav-tabs nav-stacked">
							<li class="nav-item">
								<a class="nav-link active" data-toggle="tab" href="#users">Users table</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-toggle="tab" href="#newuser">New user</a>
							</li>
						</ul>
						<div class="tab-content border">
							<!--Таблица пользователей-->
							<div class="tab-pane fade show active" id="users">
								<div class="container-fluid p-0">
									<h4 class="p-3 m-0 border">All users</h4>
								</div>
								<div class="container-fluid bg-white pb-5">
								<table class="table table-striped m-0">
									<thead>
										<tr>
											<th scope="col">ID</th>
											<th scope="col">First Name</th>
											<th scope="col">Last Name</th>
											<th scope="col">Age</th>
											<th scope="col">Email</th>
											<th scope="col">Role</th>
											<th scope="col">Edit</th>
											<th scope="col">Delete</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="user : ${users}">
											<th:block th:with="id=${user.getId()}, name=${user.getName()}, surname=${user.getSurname()},
													  		   age=${user.getAge()}, userName=${user.getUsername()}, roles=${user.getRoles()}">
											<td th:id="${'id_' + id}" th:text="${id}"></td>
											<td th:id="${'name_' + id}" th:text="${name}"></td>
											<td th:id="${'surname_' + id}" th:text="${surname}"></td>
											<td th:id="${'age_' + id}" th:text="${age}"></td>
											<td th:id="${'username_' + id}" th:text="${userName}"></td>
											<td th:id="${'roles_' + id}">
												<span th:id="${'roles_' + id}" th:each="role : ${roles}">
													<r th:text="${role.getRole().replace('ROLE_', '')}"></r>
												</span>
											</td>
											<form>
												<td><button th:attr="num=${id}" act="upd" type="button" class="btn btn-info" data-toggle="modal" data-target="#delete_modal" data-btype="delete">Edit</button></td>
												<td><button th:attr="num=${id}" act="del" type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete_modal" data-btype="delete">Delete</button></td>
											</form>
											</th:block>
										</tr>
									</tbody>
								</table>
								</div>
							</div> 
							<!--Добавление нового пользователя-->
							<div class="tab-pane fade" id="newuser">
								<div class="container-fluid p-0">
									<h4 class="p-3 m-0 border">Add new user</h4>
									<div class="container py-4">
										<div class="row justify-content-center">
											<div class="flex-col col-8 col-sm-7 col-md-6 col-lg-5 col-xl-4">
												<form method="post">
													<div class="form-group">
														<div class="text-center">
															<h5><b>First name</b></h5>
														</div>
														<input type="text" class="form-control" name="name" placeholder="First name">
													</div>
													<div class="form-group">
														<div class="text-center">
															<h5><b>Last name</b></h5>
														</div>
														<input type="text" class="form-control" name="surname" placeholder="Last name">
													</div>
													<div class="form-group">
														<div class="text-center">
															<h5><b>Age</b></h5>
														</div>
														<input type="number" class="form-control" name="age" placeholder="Age">
													</div>
													<div class="form-group">
														<div class="text-center">
															<h5><b>Email</b></h5>
														</div>
														<input type="email" class="form-control" name="username" placeholder="Email">
													</div>
													<div class="form-group">
														<div class="text-center">
															<h5><b>Password</b></h5>
														</div>
														<input type="password" class="form-control" name="password" placeholder="Password">
													</div>
													<div class="form-group">
														<div class="text-center">
															<h5><b>Role</b></h5>
														</div>
														<div style="height: 58px;">
														<select multiple class="form-control mh-100" name="roles">
															<option>ADMIN</option>
															<option>USER</option>
														</select>
														</div>
													</div>
													<button type="submit" class="btn btn-success btn-lg d-block mx-auto">Add new user</button>
												</form>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!--Модальное окно-->
							<div>
								<div class="modal fade" id="delete_modal" tabindex="-1" role="dialog" aria-labelledby="delete_modalLabel" aria-hidden="true">
									<div class="modal-dialog" role="document">
										<div class="modal-content">
											<div class="modal-header">
												<h5 th:id="head_label" class="modal-title" id="delete_modalLabel">Delete user</h5>
												<button type="button" class="close" data-dismiss="modal" aria-label="Close">
													<span aria-hidden="true">&times;</span>
												</button>
											</div>
											<div class="modal-body">
												<div class="container-fluid p-0">
													<div class="container">
														<div class="row justify-content-center">
															<div class="flex-col col-10 col-sm-9 col-md-8 col-lg-7 col-xl-6">
																<form id="del_form" action="/admin/delete" method="post">
																	<input id="hdu_id" type="hidden" name="id" value="-1">
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>ID</b></h5>
																		</div>
																		<input id="mu_id" type="text" class="form-control" placeholder="ID" disabled>
																	</div>
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>First name</b></h5>
																		</div>
																		<input id="mu_name" type="text" class="form-control" placeholder="First name" disabled>
																	</div>
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>Last name</b></h5>
																		</div>
																		<input id="mu_surname" type="text" class="form-control" placeholder="Last name" disabled>
																	</div>
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>Age</b></h5>
																		</div>
																		<input id="mu_age" type="number" class="form-control" placeholder="Age" disabled>
																	</div>
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>Email</b></h5>
																		</div>
																		<input id="mu_username" type="email" class="form-control" placeholder="Email" disabled>
																	</div>
																	<div id="password_block" class="form-group">
																		<div class="text-center">
																			<h5><b>Password</b></h5>
																		</div>
																		<input type="password" class="form-control" name="password" placeholder="Password">
																	</div>
																	<div class="form-group">
																		<div class="text-center">
																			<h5><b>Role</b></h5>
																		</div>
																		<div style="height: 58px;">
																			<select id="mu_roles" multiple class="form-control mh-100" disabled>
																				<option id="u_role_admin">ADMIN</option>
																				<option id="u_role_user">USER</option>
																			</select>
																		</div>
																	</div>
																</form>
															</div>
														</div>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
												<button id="act_button" type="button" class="btn">Delete</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!--Вкладка юзера-->
				<div class="tab-pane fade active" th:classappend="${#authorization.expression('hasRole(''ROLE_ADMIN'')')} ? '' : show" id="pill-user" role="tabpanel" aria-labelledby="user-tab">
					<h1 class="p-3">User information-page</h1>
					<div class="container-fluid bg-white p-0 border">
						<h4 class="p-3 border bg-light">About user</h4>
						<div class="p-3">
						<table class="table table-striped">
							<thead>
								<tr>
									<th scope="col">ID</th>
									<th scope="col">First Name</th>
									<th scope="col">Last Name</th>
									<th scope="col">Age</th>
									<th scope="col">Email</th>
									<th scope="col">Role</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<th th:text="${curUser.getId()}"></th>
									<td th:text="${curUser.getName()}"></td>
									<td th:text="${curUser.getSurname()}"></td>
									<td th:text="${curUser.getAge()}"></td>
									<td th:text="${curUser.getUsername()}"></td>
									<td>
										<span th:each="curRole : ${curUser.getRoles()}">
											<r th:text="${curRole.getRole().replace('ROLE_', '')}"></r>
										</span>
									</td>
								</tr>
								<tr>
							</tbody>
						</table>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	</div>
	<script src="webjars/jquery/3.3.1/jquery.min.js"></script>
	<script src="webjars/bootstrap/4.5.0/js/bootstrap.min.js"></script>
	<script src="modal.js"></script>
  </body>
</html>
